---
title: "p8105 Homework 2"
author: Rebekah Hughes
output: github_document
---

In the code chunk below, all the packages used in this homework are loaded.

```{r}
library(tidyverse)
library(readxl)
```


## Problem 1

The following code reads and cleans the Mr. Trash Wheel dataset.

```{r}
mrtrash_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
  sheet = "Mr. Trash Wheel",
  range = "A2:N408") %>%
  janitor::clean_names() %>%
  drop_na (dumpster) %>% 
  mutate (sports_balls = round (sports_balls, digits = 0), sports_balls = as.integer(sports_balls))
```

The following code reads and cleans the Precipitation data for 2017 and 2018 and combines the datasets into one.

```{r}
precip_2017 =
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
             sheet = "2017 Precipitation",
             range = "A2:B14") %>% 
  mutate(precip_year = 2017)

precip_2018 =
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
             sheet = "2018 Precipitation",
             range = "A2:B14") %>% 
  mutate(precip_year = 2018)

precip_tidy =
  bind_rows(precip_2017, precip_2018) %>% 
  janitor::clean_names() %>% 
  mutate (month.name [month])
```

The above datasets used for problem 1 have the following numbers of observations: `r nrow(mrtrash_df)` for the Mr. Trash Wheel dataset; `r nrow(precip_2017)` for the 2017 Precipitation dataset; `r nrow(precip_2018)` for the 2018 Precipitation dataset; and `r nrow(precip_tidy)` for the combined precipitation dataset. The following are examples of key variables from the Mr. Trash Wheel dataset: the mean of weight is `r mean (mrtrash_df$weight_tons)` tons, with a maximum value of `r max(mrtrash_df$weight_tons)` tons and a minimum value of `r min(mrtrash_df$weight_tons)` tons; the mean amount of grocery bags is `r mean(mrtrash_df$grocery_bags)`; and the mean amount of cigarette butts are `r mean(mrtrash_df$cigarette_butts)`, with a maximum of `r max(mrtrash_df$cigarette_butts)` and a minimum of `r min(mrtrash_df$cigarette_butts)`. The following are examples of key variables from the combined precipitation dataset and the two individual precipitation datasets: the mean total rainfall across the two years is `r mean(precip_tidy$total)` inches; the mean total rainfall for 2017 alone is `r mean(precip_2017$Total)` inches; and the mean total rainfall for 2018 is `r mean(precip_2018$Total)` inches. The total precipitation in 2018 was `r sum (precip_2018$Total)` and the median number of sports balls in a dumpster in 2017 was `r median (mrtrash_df$sports_balls, "year" == 2017)`.


## Problem 2

```{r}
nycsub_df = 
  read_csv ("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(
    line, station_name, station_latitude, station_longitude, route1, route2, route3,route4,
    route5, route6, route7, route8, route9, route10, route11, entry, vending, entrance_type,
    ada)%>%
  mutate(entry = recode(entry, YES = TRUE, NO = FALSE))
```

The above dataset contains the line, station name, routes 1-11, vending and entrance type as character variables, station latitude and longitude as nunerical variables, and ADA compliance and the recoded entry variable as logical variables. So far to clean the data, clean names has been done, certain variables have been cut out of the dataset, and entry has been recoded as a logical variable. The dimensions of the dataset are `r nrow(nycsub_df)` rows by `r ncol(nycsub_df)` columns. The data is more tidy than what it was initally but could be made more tidy still.

The following code makes station name a distinct variable.

```{r}
nycsub_dist =
  nycsub_df %>% 
  distinct(line, station_name) %>% 
  count()
```

Using the above code, it can be determined that there are 465 distinct stations.

The following code computes how many stations are ADA compliant.

```{r}
nycada_df =
  nycsub_df %>% 
  distinct(line, station_name, .keep_all = TRUE) %>% 
  filter(ada == TRUE) %>% 
  count()
```

According to the output of the above code, there are 84 stations that are ADA compliant.

The following code calculates the proportion of station entrances/exits without vending that allow entrance.

```{r}
nycsub_filt = 
  nycsub_df %>%
  filter(vending == "NO", entry == TRUE) %>%
  mutate(proportion = entry / sum(entry))
```

According to the above code, the proportion of station entrances/exits without vending that allow entrance is about 0.0145 or 1.45%.

The following code reformats route number and route name as distinct variables.

```{r}
nycsub_tidy =
  nycsub_df %>%
  mutate(route8 = as.character(route8), route9 = as.character(route9), route10 = as.character(route10), route11 = as.character(route11)) %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_name",
    names_prefix = "route",
    values_to = "route_number"
  )

nyc_sub_a =
  nycsub_tidy %>% 
  distinct(line, station_name, .keep_all = TRUE) %>% 
  filter(route_number == "A") %>% 
  count()
```

From the above code, it can be determined that 60 distinct stations serve the A train.

```{r}
nyc_sub_a_ada =
  nycsub_tidy %>% 
  distinct(line, station_name, .keep_all = TRUE) %>% 
  filter(route_number == "A", ada == TRUE) %>% 
  count()
```

Given the above code, it can be concluded that of the stations that serve the A train, only 17 are ADA compliant.


## Problem 3

```{r}
pols_month_df =
  read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, c("year", "month", "day")) %>%
  mutate_at ("month"=recode('01'="Jan", '02'="Feb")) %>% 
  mutate(month.name[month]) %>% 
  pivot_longer(
    cols = starts_with("prez"),
    names_to = "president",
    names_prefix = "prez_") %>%
    select(-day)
```

```{r}
sp_df =
  read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, c("month", "day", "year")) %>% 
  mutate_at ("month"=recode('01'="Jan", '02'="Feb")) %>% 
  select(-day) %>% 
  arrange(year, month)
```

```{r}
unemploy_df =
  read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemploy_prop"
  )
```

```{r}
fivethirtyeight_df =
  left_join(pols_month_df, sp_df, by = "year") %>% 
  left_join(unemploy_df, by = "year") %>% 
  arrange(year)
```

